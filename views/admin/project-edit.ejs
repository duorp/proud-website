<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Edit – <%= project.title %></title>
</head>
<body>

  <a href="/admin/projects">← Back</a>

  <h1>Edit project</h1>

  <form method="POST">

    <label>
      Title<br>
      <input name="title" value="<%= project.title %>">
    </label>

    <br><br>

    <label>
      Headline<br>
      <input name="headline" value="<%= project.headline %>">
    </label>

    <br><br>

    <label>
      Description<br>
      <textarea name="description"><%= project.description %></textarea>
    </label>

    <br><br>

    <label>
      Hero image path<br>
      <input name="hero_image" value="<%= project.hero_image %>">
    </label>

    <br><br>

    <label>
      Tags (comma separated)<br>
      <input
        name="tags"
        value="<%= project.tags.join(', ') %>"
      >
    </label>

    <hr>

    <h2>Blocks</h2>

<div id="blocks">
  <% project.blocks.forEach((block, i) => { %>
    <div class="block" data-index="<%= i %>">

      <input
        type="hidden"
        name="blocks[<%= i %>][type]"
        value="<%= block.type %>"
      >

      <% if (block.type === "text") { %>
        <textarea name="blocks[<%= i %>][content]"><%= block.content %></textarea>
      <% } %>

      <% if (block.type === "image") { %>
        <input
          name="blocks[<%= i %>][src]"
          value="<%= block.src %>"
          placeholder="/images/example.jpg"
        >
      <% } %>

      <% if (block.type === "customhtml") { %>
        <textarea
          name="blocks[<%= i %>][content]"
          rows="6"
        ><%= block.content %></textarea>
      <% } %>

      <button type="button" class="delete-block">Delete</button>

    </div>
  <% }) %>
</div>

    </div>


</div>

<button type="button" data-add="text">Add text</button>
<button type="button" data-add="image">Add image</button>
<button type="button" data-add="customhtml">Add custom HTML</button>



    <br>

    <button type="submit">Save</button>

  </form>

</body>

<script>
  const blocks = document.getElementById("blocks");

  function newBlock(type) {
    const i = blocks.children.length;
    const div = document.createElement("div");
    div.className = "block";
    div.dataset.index = i;

    let fields = "";

    if (type === "text") {
      fields = `<textarea name="blocks[${i}][content]"></textarea>`;
    }

    if (type === "image") {
      fields = `<input name="blocks[${i}][src]" placeholder="/images/example.jpg">`;
    }

    if (type === "customhtml") {
      fields = `<textarea name="blocks[${i}][content]" rows="6"></textarea>`;
    }

    div.innerHTML = `
      <input type="hidden" name="blocks[${i}][type]" value="${type}">
      ${fields}
      <button type="button" class="delete-block">Delete</button>
    `;

    blocks.appendChild(div);
  }

  document.addEventListener("click", e => {
    if (e.target.dataset.add) {
      newBlock(e.target.dataset.add);
    }

    if (e.target.classList.contains("delete-block")) {
      e.target.closest(".block").remove();
    }
  });
</script>

</html>

